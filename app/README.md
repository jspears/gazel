# Gazel Web Connect Service

This module provides a web client for the Gazel API using the Bazel-generated protobuf types.

## Overview

The `app/src` directory contains:
- **Type definitions** from Bazel-generated protobuf files (`bazel-bin/proto`)
- **HTTP client** for communicating with the Gazel server
- **High-level API client** for easier usage in web applications

## Installation

```bash
cd app
pnpm install
pnpm run build
```

## Usage

### Using the HTTP Client

```typescript
import { createHttpClient } from '@gazel/connect';

const client = createHttpClient('http://localhost:3002');

// Get current workspace
const workspace = await client.getCurrentWorkspace();

// List targets
const targets = await client.listTargets('//...');

// Get module graph
const graph = await client.getModuleGraph();
```

### Using the High-Level API Client

```typescript
import { GazelApiClient } from '@gazel/connect/client';

const api = new GazelApiClient('http://localhost:3002');

// Workspace operations
const workspace = await api.getCurrentWorkspace();
await api.switchWorkspace('/path/to/workspace');
const info = await api.getWorkspaceInfo();

// Target operations
const targets = await api.listTargets();
const target = await api.getTarget('//app:main');
const results = await api.searchTargets('test');

// Query operations
const queryResult = await api.executeQuery('deps(//...)');

// Build operations
const buildResult = await api.buildTarget('//app:main');

// Module operations
const moduleGraph = await api.getModuleGraph();
```

### Using Bazel-Generated Types

```typescript
import type {
  WorkspaceInfo,
  BazelTarget,
  Module,
  ModuleDependency,
} from '@gazel/connect';

// These types are generated by Bazel from the proto files
// and provide full TypeScript type safety
```

## Architecture

```
app/src/
├── index.ts        # Main entry point, exports types and clients
├── http-client.ts  # HTTP client implementation
├── client.ts       # High-level API client wrapper
└── example.html    # Browser example demonstrating usage
```

## Bazel Integration

This module uses types generated by Bazel's `ts_proto_library` rule. The generated files are located in `bazel-bin/proto/` and include:

- `gazel_pb.js` / `gazel_pb.d.ts` - Protobuf message types
- `logging_pb.js` / `logging_pb.d.ts` - Logging-related types

To regenerate the types after modifying the proto files:

```bash
bazel build //proto:gazel_ts_proto
bazel build //proto:logging_ts_proto
```

## Connect Protocol Support

While this module currently uses HTTP for communication, it's designed to support the Connect protocol in the future. The Connect protocol provides:

- Type-safe RPC calls
- Streaming support
- Better error handling
- Binary and JSON encoding

To add full Connect support, you would need to:

1. Add Connect service generation to the Bazel build
2. Update the server to use Connect handlers
3. Switch the client from HTTP to Connect transport

## Example

Open `app/example.html` in a browser to see a working example of the client in action. Make sure the Gazel server is running on port 3002:

```bash
# Start the server
pnpm run dev:server

# Open the example in a browser
open app/example.html
```

## Development

```bash
# Install dependencies
pnpm install

# Build TypeScript
pnpm run build

# Watch for changes
pnpm run watch
```

## Notes

- The client automatically detects the environment and uses appropriate defaults
- All API calls return promises and support async/await
- Error handling is built into the high-level client
- The HTTP client provides a lower-level interface for custom implementations
